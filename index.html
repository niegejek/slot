<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <title>Psycho Slot - Full Integration 2026</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <!-- Import bibliotek z pewnych ÅºrÃ³deÅ‚ -->
    <script src="cdnjs.cloudflare.com"></script>
    <script src="cdnjs.cloudflare.com"></script>

    <script>
        let gameState = "IDLE";
        let hue = 0;

        (async () => {
            // 1. INICJALIZACJA PIXI (v8)
            const app = new PIXI.Application();
            await app.init({ 
                width: 1280, 
                height: 720, 
                backgroundColor: 0x050510,
                antialias: true 
            });
            document.body.appendChild(app.canvas);

            // 2. FILTRY (Blur do Dreamcore)
            const blurFilter = new PIXI.BlurFilter();
            blurFilter.blur = 0;
            app.stage.filters = [blurFilter];

            // 3. SCENA I RAMKA
            const mainScene = new PIXI.Container();
            app.stage.addChild(mainScene);

            const frame = new PIXI.Graphics()
                .roundRect(240, 80, 800, 480, 40)
                .fill({ color: 0x000000, alpha: 0.8 })
                .stroke({ width: 8, color: 0xff00ff });
            mainScene.addChild(frame);

            // 4. AUDIO SYSTEM
            let audioCtx, analyser, dataArray;
            function initAudio() {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 256;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                console.log("Audio Pulse Ready");
            }

            // 5. BONUS BUY - PORTALE
            const bonusUI = new PIXI.Container();
            app.stage.addChild(bonusUI);

            function openBonusBuy() {
                gameState = "BONUS_SELECT";
                gsap.to(mainScene, { alpha: 0.3, duration: 0.5 });
                
                const p1 = createPortal("ðŸŒ«ï¸ DREAMCORE", 440, 320, 0x00ffff, () => startBonus("DREAM"));
                const p2 = createPortal("ðŸ‘ï¸ DMT", 840, 320, 0xff0000, () => startBonus("DMT"));
                bonusUI.addChild(p1, p2);
            }

            function createPortal(txt, x, y, col, action) {
                const c = new PIXI.Container();
                const g = new PIXI.Graphics()
                    .circle(0, 0, 100)
                    .stroke({ width: 4, color: col });
                
                const t = new PIXI.Text({
                    text: txt,
                    style: { fill: col, fontSize: 24, fontWeight: 'bold' }
                });
                t.anchor.set(0.5);
                
                c.addChild(g, t);
                c.position.set(x, y);
                c.eventMode = 'static';
                c.cursor = 'pointer';
                c.on('pointerdown', action);
                
                // Animacja portalu
                gsap.to(c.scale, { x: 1.1, y: 1.1, duration: 1, yoyo: true, repeat: -1 });
                
                return c;
            }

            // 6. TRYBY GRY
            function startBonus(type) {
                bonusUI.removeChildren();
                gsap.to(mainScene, { alpha: 1, duration: 1 });
                gameState = (type === "DMT") ? "BONUS_DMT" : "BONUS_DREAM";
                
                if (type === "DMT") {
                    gsap.to(frame.scale, { x: 1.05, y: 1.05, duration: 0.1, yoyo: true, repeat: 10 });
                }
            }

            // 7. PRZYCISK START (Zielona kropka)
            const spinBtn = new PIXI.Graphics()
                .circle(0, 0, 50)
                .fill(0x00ff66);
            spinBtn.position.set(1140, 620);
            spinBtn.eventMode = 'static';
            spinBtn.cursor = 'pointer';
            
            spinBtn.on('pointerdown', () => {
                if (!audioCtx) initAudio(); // Aktywacja po kliku (wymÃ³g przeglÄ…darki)
                if (gameState === "IDLE") openBonusBuy();
                else {
                    gameState = "IDLE";
                    blurFilter.blur = 0;
                    mainScene.position.set(0,0);
                }
            });
            app.stage.addChild(spinBtn);

            // 8. TICKER (Animacje i Audio)
            app.ticker.add(() => {
                // TÄ™czowa ramka
                hue += 1;
                frame.tint = PIXI.Color.shared.setValue(`hsl(${hue % 360}, 100%, 60%)`).toNumber();

                // Pulsowanie przycisku od "audio" (symulacja jeÅ›li brak muzyki)
                if (analyser) {
                    analyser.getByteFrequencyData(dataArray);
                    let avg = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    spinBtn.scale.set(1 + avg / 150);
                }

                // Efekt DMT (Screen Shake)
                if (gameState === "BONUS_DMT") {
                    mainScene.x = (Math.random() - 0.5) * 10;
                    mainScene.y = (Math.random() - 0.5) * 10;
                }

                // Efekt Dreamcore (Blur)
                if (gameState === "BONUS_DREAM") {
                    blurFilter.blur = Math.sin(Date.now() * 0.004) * 10 + 10;
                }
            });
        })();
    </script>
</body>
</html>
